version: '3.8'

services:
  # -----------------------------
  # ğŸ” Auth Service
  # Handles: register, login, JWT, Google OAuth2
  # -----------------------------
  auth-service:
    build: ./services/auth-service
    env_file:
      - ./services/auth-service/.env
    volumes:
      - auth-data:/app/data
    ports:
      - "3001:3001"
    networks:
      - ft_net
  # -----------------------------
  # ğŸ‘¥ User Service
  # Handles: profiles, friendships
  # -----------------------------
  user-service:
    build: ./services/user-service
    env_file:
      - ./services/user-service/.env
    volumes:
      - user-data:/app/data
    ports:
     - "3002:3002"
    networks:
      - ft_net

  # -----------------------------
  # Chat Service
  # -----------------------------
  chat-service:
    build: ./services/chat-service
    env_file:
      - ./services/chat-service/.env
    depends_on:
      - user-service
    volumes:
      - chat-data:/app/data
    ports:
     - "3003:3003"
    networks:
      - ft_net

  # -----------------------------
  # ğŸŒ Nginx API Gateway + Frontend
  # Routes: /api/* â†’ services, / â†’ frontend
  # -----------------------------
  nginx:
    build: ./nginx
    ports:
      - "80:80"
      # - "443:443"  # Uncomment when using SSL
    depends_on:
      - auth-service
      - user-service
      - chat-service
    networks:
      - ft_net

networks:
  ft_net:
    driver: bridge

volumes:
  auth-data:
  user-data:
  chat-data: